# SQL Execution Plan Visualizer

This is a web application for comparing and optimizing SQL query execution plans using PostgreSQL's `EXPLAIN ANALYZE` and the SQLCoder LLM.

Understanding SQL performance is notoriously difficult. Small changes in syntax can produce radically different execution behavior, and while `EXPLAIN ANALYZE` provides detailed insights, its output is often verbose and hard to interpret, especially when comparing multiple queries.

This tool provides:
- A web interface to enter and compare two SQL queries side by side
- Visual diagrams of execution plans, with cost and timing breakdowns
- Output validation to ensure both queries return the same results
- Automatic query improvement suggestions generated by an LLM

The goal is to make query performance analysis more approachable, visual, and actionable.

## Development

### Challenges
- Using EXPLAIN ANALYZE for the first time
- Finding what visual representations of query plans are most understandable
- Integration (Flask, PostgresQL, JavaScript)
- Optimizing the LLM (runtime)

### Future Work
- LLM gives written feedback and explanations
- Support for more SQL dialects (MySQL)
- Support for custom database schemas
- Add percent cost for each operator (in the plan node diagram)

## Prerequisites

- Python 3.8+
- PostgreSQL 12+
- Graphviz
- LLaMA model and binary files

## Setup

1. Clone the repository:
```bash
git clone <repository-url>
cd databases_final_project
```

2. Create and activate a virtual environment:
```bash
python -m venv venv
source venv/bin/activate
```

3. Install dependencies:
```bash
pip install -r requirements.txt
```

4. Install Graphviz:
```bash
# Ubuntu/Debian
sudo apt-get install graphviz
# Arch based
pacman -S graphviz
```

5. Configure environment variables:

Edit `db.py` with your database credentials.

6. Download SQLCoder model:
```bash
wget https://huggingface.co/defog/sqlcoder-7b-2/resolve/main/sqlcoder-7b-q5_k_m.gguf
```

7. Download PostgreSQL:

Visit [PostgreSQL's official website](https://www.postgresql.org/) for installation instructions specific to your operating system.

8. Run the application:
```bash
python app.py
```

The application will be available at [`http://127.0.0.1:5000/`](http://127.0.0.1:5000/)

## Project Structure

```
.
├── app.py                    # Main Flask application
├── db.py                     # Database connection and queries
├── requirements.txt          # Python dependencies
├── style.css                 # CSS
├── index.html                # HTML
└── sqlcoder-7b-q5_k_m.guff   # LLaMA model files (not included)
```

## Usage

1. Enter your SQL query in the first text box
2. Either:
   - Click "Suggest Optimization" to get an AI suggested optimization
   - Enter a different query in the second box
3. Click "Compare Plans" to see the execution plans side by side